{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import{enrollStudent}from\"../api\";/**\n * A single component that:\n * 1) Tries to get camera access via getUserMedia.\n * 2) Provides a file upload fallback.\n * 3) Lets the user enter a student name.\n * 4) Uploads the final chosen image to your backend to enroll a new student.\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Enrollment(){const[studentName,setStudentName]=useState(\"\");const[hasCamera,setHasCamera]=useState(false);const[cameraError,setCameraError]=useState(\"\");const[stream,setStream]=useState(null);const[previewUrl,setPreviewUrl]=useState(null);// For local preview\nconst[capturedBlob,setCapturedBlob]=useState(null);const[status,setStatus]=useState(\"\");const videoRef=useRef(null);// On mount, try to request camera access\nuseEffect(()=>{async function initCamera(){try{const s=await navigator.mediaDevices.getUserMedia({video:true});setStream(s);setHasCamera(true);setCameraError(\"\");}catch(err){console.error(\"Camera init error:\",err);setHasCamera(false);setCameraError(\"Camera not accessible. Please upload a file instead.\");}}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){initCamera();}else{setCameraError(\"getUserMedia not supported in this browser.\");}},[]);// Attach stream to videoRef\nuseEffect(()=>{if(videoRef.current&&stream){videoRef.current.srcObject=stream;}return()=>{// Cleanup: stop camera if unmount\nif(stream){stream.getTracks().forEach(track=>track.stop());}};},[stream]);// Capture from webcam\nconst handleCapture=()=>{if(!videoRef.current)return;const video=videoRef.current;const width=video.videoWidth;const height=video.videoHeight;const canvas=document.createElement(\"canvas\");canvas.width=width;canvas.height=height;const ctx=canvas.getContext(\"2d\");ctx.drawImage(video,0,0,width,height);canvas.toBlob(blob=>{if(blob){setCapturedBlob(blob);const url=URL.createObjectURL(blob);setPreviewUrl(url);}},\"image/jpeg\",0.8);};// Handle file upload\nconst handleFileChange=e=>{const file=e.target.files[0];if(file){setCapturedBlob(file);const url=URL.createObjectURL(file);setPreviewUrl(url);}};// Submit to enroll\nconst handleEnroll=async()=>{if(!studentName){setStatus(\"Please enter a student name.\");return;}if(!capturedBlob){setStatus(\"Please capture or upload an image first.\");return;}try{// enrollStudent is your API call to the backend\nconst res=await enrollStudent(studentName,capturedBlob);setStatus(res.message||\"Enrollment successful!\");// Clear fields\nsetStudentName(\"\");setCapturedBlob(null);setPreviewUrl(null);}catch(error){console.error(error);setStatus(\"Enrollment failed.\");}};return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"20px\"},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Enroll New Student\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Student Name:\",\" \",/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:studentName,onChange:e=>setStudentName(e.target.value)})]})}),hasCamera?/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"10px\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:\"320px\",height:\"240px\",background:\"#000\",marginBottom:\"10px\"},children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,style:{width:\"100%\",height:\"auto\"}})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCapture,children:\"Take Photo\"})]}):/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\",marginTop:\"10px\"},children:cameraError}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:\"10px\"},children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Or Upload Image:\",\" \",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleFileChange})]})}),previewUrl&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"10px\"},children:[/*#__PURE__*/_jsx(\"p\",{children:\"Preview:\"}),/*#__PURE__*/_jsx(\"img\",{src:previewUrl,alt:\"preview\",style:{maxWidth:\"320px\",maxHeight:\"240px\"}})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:\"10px\"},children:/*#__PURE__*/_jsx(\"button\",{onClick:handleEnroll,children:\"Enroll Student\"})}),/*#__PURE__*/_jsx(\"p\",{style:{color:\"blue\",marginTop:\"10px\"},children:status})]});}export default Enrollment;","map":{"version":3,"names":["React","useState","useEffect","useRef","enrollStudent","jsx","_jsx","jsxs","_jsxs","Enrollment","studentName","setStudentName","hasCamera","setHasCamera","cameraError","setCameraError","stream","setStream","previewUrl","setPreviewUrl","capturedBlob","setCapturedBlob","status","setStatus","videoRef","initCamera","s","navigator","mediaDevices","getUserMedia","video","err","console","error","current","srcObject","getTracks","forEach","track","stop","handleCapture","width","videoWidth","height","videoHeight","canvas","document","createElement","ctx","getContext","drawImage","toBlob","blob","url","URL","createObjectURL","handleFileChange","e","file","target","files","handleEnroll","res","message","style","marginTop","children","type","value","onChange","background","marginBottom","ref","autoPlay","playsInline","onClick","color","accept","src","alt","maxWidth","maxHeight"],"sources":["/Users/amber/gitlab/student-engagement-system/frontend/src/components/Enrollment.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { enrollStudent } from \"../api\";\n\n/**\n * A single component that:\n * 1) Tries to get camera access via getUserMedia.\n * 2) Provides a file upload fallback.\n * 3) Lets the user enter a student name.\n * 4) Uploads the final chosen image to your backend to enroll a new student.\n */\nfunction Enrollment() {\n  const [studentName, setStudentName] = useState(\"\");\n  const [hasCamera, setHasCamera] = useState(false);\n  const [cameraError, setCameraError] = useState(\"\");\n  const [stream, setStream] = useState(null);\n\n  const [previewUrl, setPreviewUrl] = useState(null);  // For local preview\n  const [capturedBlob, setCapturedBlob] = useState(null);\n\n  const [status, setStatus] = useState(\"\");\n  const videoRef = useRef(null);\n\n  // On mount, try to request camera access\n  useEffect(() => {\n    async function initCamera() {\n      try {\n        const s = await navigator.mediaDevices.getUserMedia({ video: true });\n        setStream(s);\n        setHasCamera(true);\n        setCameraError(\"\");\n      } catch (err) {\n        console.error(\"Camera init error:\", err);\n        setHasCamera(false);\n        setCameraError(\"Camera not accessible. Please upload a file instead.\");\n      }\n    }\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n      initCamera();\n    } else {\n      setCameraError(\"getUserMedia not supported in this browser.\");\n    }\n  }, []);\n\n  // Attach stream to videoRef\n  useEffect(() => {\n    if (videoRef.current && stream) {\n      videoRef.current.srcObject = stream;\n    }\n    return () => {\n      // Cleanup: stop camera if unmount\n      if (stream) {\n        stream.getTracks().forEach((track) => track.stop());\n      }\n    };\n  }, [stream]);\n\n  // Capture from webcam\n  const handleCapture = () => {\n    if (!videoRef.current) return;\n    const video = videoRef.current;\n    const width = video.videoWidth;\n    const height = video.videoHeight;\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(video, 0, 0, width, height);\n    canvas.toBlob((blob) => {\n      if (blob) {\n        setCapturedBlob(blob);\n        const url = URL.createObjectURL(blob);\n        setPreviewUrl(url);\n      }\n    }, \"image/jpeg\", 0.8);\n  };\n\n  // Handle file upload\n  const handleFileChange = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      setCapturedBlob(file);\n      const url = URL.createObjectURL(file);\n      setPreviewUrl(url);\n    }\n  };\n\n  // Submit to enroll\n  const handleEnroll = async () => {\n    if (!studentName) {\n      setStatus(\"Please enter a student name.\");\n      return;\n    }\n    if (!capturedBlob) {\n      setStatus(\"Please capture or upload an image first.\");\n      return;\n    }\n    try {\n      // enrollStudent is your API call to the backend\n      const res = await enrollStudent(studentName, capturedBlob);\n      setStatus(res.message || \"Enrollment successful!\");\n      // Clear fields\n      setStudentName(\"\");\n      setCapturedBlob(null);\n      setPreviewUrl(null);\n    } catch (error) {\n      console.error(error);\n      setStatus(\"Enrollment failed.\");\n    }\n  };\n\n  return (\n    <div style={{ marginTop: \"20px\" }}>\n      <h2>Enroll New Student</h2>\n      <div>\n        <label>\n          Student Name:{\" \"}\n          <input\n            type=\"text\"\n            value={studentName}\n            onChange={(e) => setStudentName(e.target.value)}\n          />\n        </label>\n      </div>\n\n      {/* If we have camera access, show a webcam preview + \"Take Photo\" button */}\n      {hasCamera ? (\n        <div style={{ marginTop: \"10px\" }}>\n          <div\n            style={{\n              width: \"320px\",\n              height: \"240px\",\n              background: \"#000\",\n              marginBottom: \"10px\",\n            }}\n          >\n            <video\n              ref={videoRef}\n              autoPlay\n              playsInline\n              style={{ width: \"100%\", height: \"auto\" }}\n            />\n          </div>\n          <button onClick={handleCapture}>Take Photo</button>\n        </div>\n      ) : (\n        <p style={{ color: \"red\", marginTop: \"10px\" }}>{cameraError}</p>\n      )}\n\n      {/* File upload fallback */}\n      <div style={{ marginTop: \"10px\" }}>\n        <label>\n          Or Upload Image:{\" \"}\n          <input type=\"file\" accept=\"image/*\" onChange={handleFileChange} />\n        </label>\n      </div>\n\n      {/* Preview final selected image */}\n      {previewUrl && (\n        <div style={{ marginTop: \"10px\" }}>\n          <p>Preview:</p>\n          <img\n            src={previewUrl}\n            alt=\"preview\"\n            style={{ maxWidth: \"320px\", maxHeight: \"240px\" }}\n          />\n        </div>\n      )}\n\n      {/* Enroll button */}\n      <div style={{ marginTop: \"10px\" }}>\n        <button onClick={handleEnroll}>Enroll Student</button>\n      </div>\n\n      <p style={{ color: \"blue\", marginTop: \"10px\" }}>{status}</p>\n    </div>\n  );\n}\n\nexport default Enrollment;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{getEngagement}from\"../api\";import{Line}from\"react-chartjs-2\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function EngagementChart(){const[records,setRecords]=useState([]);const[alertMsg,setAlertMsg]=useState(\"\");const loadData=async()=>{try{const data=await getEngagement();setRecords(data);if(data.length>0){// check the latest record\nconst last=data[0];if(last.phone_detected||last.gaze!==\"focused\"){setAlertMsg(`ALERT: Student not focusing or using phone. phone=${last.phone_detected}, gaze=${last.gaze}`);}else{setAlertMsg(\"\");}}}catch(err){console.error(err);}};useEffect(()=>{loadData();const interval=setInterval(loadData,60000);// poll every min\nreturn()=>clearInterval(interval);},[]);const chartData={labels:records.map(r=>r.timestamp.slice(11,19)),datasets:[{label:\"Face Count\",data:records.map(r=>r.face_count),borderWidth:2}]};return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"20px\"},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Engagement Chart\"}),alertMsg&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\",fontWeight:\"bold\"},children:alertMsg}),/*#__PURE__*/_jsx(Line,{data:chartData}),/*#__PURE__*/_jsxs(\"table\",{border:\"1\",cellPadding:\"5\",style:{marginTop:\"10px\"},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Timestamp\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Faces\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Phone?\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Gaze\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Head Pos\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Image\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:records.map(r=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:r.id}),/*#__PURE__*/_jsx(\"td\",{children:r.timestamp}),/*#__PURE__*/_jsx(\"td\",{children:r.face_count}),/*#__PURE__*/_jsx(\"td\",{children:r.recognized_student||\"Unknown\"}),/*#__PURE__*/_jsx(\"td\",{children:r.phone_detected?\"Yes\":\"No\"}),/*#__PURE__*/_jsx(\"td\",{children:r.gaze}),/*#__PURE__*/_jsx(\"td\",{children:r.head_position}),/*#__PURE__*/_jsx(\"td\",{children:r.blob_url?/*#__PURE__*/_jsx(\"img\",{src:r.blob_url,alt:\"capture\",width:\"80\"}):null})]},r.id))})]})]});}export default EngagementChart;","map":{"version":3,"names":["React","useState","useEffect","getEngagement","Line","jsx","_jsx","jsxs","_jsxs","EngagementChart","records","setRecords","alertMsg","setAlertMsg","loadData","data","length","last","phone_detected","gaze","err","console","error","interval","setInterval","clearInterval","chartData","labels","map","r","timestamp","slice","datasets","label","face_count","borderWidth","style","marginTop","children","color","fontWeight","border","cellPadding","id","recognized_student","head_position","blob_url","src","alt","width"],"sources":["/Users/amber/gitlab/student-engagement-system/frontend/src/components/EngagementChart.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { getEngagement } from \"../api\";\nimport { Line } from \"react-chartjs-2\";\n\nfunction EngagementChart() {\n  const [records, setRecords] = useState([]);\n  const [alertMsg, setAlertMsg] = useState(\"\");\n\n  const loadData = async () => {\n    try {\n      const data = await getEngagement();\n      setRecords(data);\n      if (data.length > 0) {\n        // check the latest record\n        const last = data[0];\n        if (last.phone_detected || last.gaze !== \"focused\") {\n          setAlertMsg(\n            `ALERT: Student not focusing or using phone. phone=${last.phone_detected}, gaze=${last.gaze}`\n          );\n        } else {\n          setAlertMsg(\"\");\n        }\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  useEffect(() => {\n    loadData();\n    const interval = setInterval(loadData, 60_000); // poll every min\n    return () => clearInterval(interval);\n  }, []);\n\n  const chartData = {\n    labels: records.map(r => r.timestamp.slice(11, 19)),\n    datasets: [\n      {\n        label: \"Face Count\",\n        data: records.map(r => r.face_count),\n        borderWidth: 2\n      }\n    ]\n  };\n\n  return (\n    <div style={{ marginTop: \"20px\" }}>\n      <h2>Engagement Chart</h2>\n      {alertMsg && <p style={{ color: \"red\", fontWeight: \"bold\" }}>{alertMsg}</p>}\n      <Line data={chartData} />\n      <table border=\"1\" cellPadding=\"5\" style={{ marginTop: \"10px\" }}>\n        <thead>\n          <tr>\n            <th>ID</th>\n            <th>Timestamp</th>\n            <th>Faces</th>\n            <th>Student</th>\n            <th>Phone?</th>\n            <th>Gaze</th>\n            <th>Head Pos</th>\n            <th>Image</th>\n          </tr>\n        </thead>\n        <tbody>\n          {records.map(r => (\n            <tr key={r.id}>\n              <td>{r.id}</td>\n              <td>{r.timestamp}</td>\n              <td>{r.face_count}</td>\n              <td>{r.recognized_student || \"Unknown\"}</td>\n              <td>{r.phone_detected ? \"Yes\" : \"No\"}</td>\n              <td>{r.gaze}</td>\n              <td>{r.head_position}</td>\n              <td>\n                {r.blob_url ? (\n                  <img src={r.blob_url} alt=\"capture\" width=\"80\" />\n                ) : null}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport default EngagementChart;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}